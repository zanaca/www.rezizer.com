L.TileLayer.RezizeЯ=L.TileLayer.extend({options:{continuousWorld:!0,tolerance:.8,scrollWheelZoom:!1},initialize:function(a,b){b=L.setOptions(this,b),this._url=a;var c=L.point(b.width,b.height),d=b.tileSize;for(this._imageSize=[c],this._gridSize=[this._getGridSize(c)];parseInt(c.x)>d||parseInt(c.y)>d;)c=c.divideBy(2).floor(),this._imageSize.push(c),this._gridSize.push(this._getGridSize(c));this._imageSize.reverse(),this._gridSize.reverse(),this.options.maxZoom=this._gridSize.length-1},onAdd:function(a){L.TileLayer.prototype.onAdd.call(this,a);var b=a.getSize(),c=this._getBestFitZoom(b),d=this._imageSize[c],e=a.options.crs.pointToLatLng(L.point(d.x/2,d.y/2),c);a.setView(e,c,!0)},_getGridSize:function(a){var b=this.options.tileSize;return L.point(Math.ceil(a.x/b),Math.ceil(a.y/b))},_getBestFitZoom:function(a){for(var d,c,b=this.options.tolerance,c=this._imageSize.length-1;c;){if(d=this._imageSize[c],d.x*b<a.x&&d.y*b<a.y)return c;c--}return c},_tileShouldBeLoaded:function(a){var b=this._gridSize[this._map.getZoom()];return a.x>=0&&a.x<b.x&&a.y>=0&&a.y<b.y},_addTile:function(a,b){var c=this._getTilePos(a),d=this._getTile(),e=this._map.getZoom(),f=this._imageSize[e],g=this._gridSize[e],h=this.options.tileSize;a.x===g.x-1&&(d.style.width=f.x-h*(g.x-1)+"px"),a.y===g.y-1&&(d.style.height=f.y-h*(g.y-1)+"px"),L.DomUtil.setPosition(d,c,L.Browser.chrome||L.Browser.android23),this._tiles[a.x+":"+a.y]=d,this._loadTile(d,a),d.parentNode!==this._tileContainer&&b.appendChild(d)},getTileUrl:function(a){return this._url+this._getTileGroup(a)+"/"+this._map.getZoom()+"-"+a.x+"-"+a.y+".jpg"},_getTileGroup:function(a){var d,b=this._map.getZoom(),c=0;for(z=0;z<b;z++)d=this._gridSize[z],c+=d.x*d.y;return c+=a.y*this._gridSize[b].x+a.x,Math.floor(c/256)}}),L.tileLayer.rezizer=function(a,b){return new L.TileLayer.RezizeЯ(a,b)};
